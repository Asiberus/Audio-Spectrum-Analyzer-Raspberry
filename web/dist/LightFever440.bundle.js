window.LightFever440=function(){"use strict";var t={436:function(t,e,o){function n(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}o.d(e,{default:function(){return y}});var i=function(){function t(e,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._dom={overlay:document.getElementById("modal-overlay"),stroboscope:{container:document.getElementById("stroboscope-modal"),delay:document.getElementById("strob-delay"),delayText:document.getElementById("strob-delay-value"),color:document.getElementById("strob-color")},colorPicker:{container:document.getElementById("color-picker-modal")}},"STROBOSCOPE"===e?(window.rangesliderJs.create(this._dom.stroboscope.delay,{value:window.localStorage.getItem("strob-delay")||"50"}),this._stroboscopeModal()):"COLOR_PICKER"===e&&this._colorPickerModal(o.color,o.callback)}var e,o;return e=t,(o=[{key:"_stroboscopeModal",value:function(){var t=this;this._dom.overlay.classList.add("visible"),this._dom.stroboscope.container.classList.add("visible");var e=function(e){t._dom.stroboscope.delayText.innerHTML=e.target.value,window.localStorage.setItem("strob-delay",e.target.value)},o=function(i){"strob-modal-close"!==i.target.id&&"modal-overlay"!==i.target.id||(t._dom.overlay.classList.remove("visible"),t._dom.stroboscope.container.classList.remove("visible"),t._dom.stroboscope.delay.removeEventListener("click",e),t._dom.overlay.removeEventListener("click",o),document.getElementById("strob-modal-close").removeEventListener("click",o),n.destroy())};e=e.bind(this),o=o.bind(this);var n=new window.KellyColorPicker({place:"strob-color-picker",color:window.localStorage.getItem("strob-color")||"#ffffff",changeCursor:!1,userEvents:{change:function(t){window.localStorage.setItem("strob-color",t.getCurColorHex()),document.getElementById("strob-color").value=t.getCurColorHex()}}});document.getElementById("strob-color").addEventListener("click",(function(t){t.preventDefault()})),this._dom.stroboscope.delay.addEventListener("input",e),this._dom.overlay.addEventListener("click",o),document.getElementById("strob-modal-close").addEventListener("click",o)}},{key:"_colorPickerModal",value:function(t,e){var o=this;this._dom.overlay.classList.add("visible"),this._dom.colorPicker.container.classList.add("visible");var n=function(t){"color-picker-modal-close"!==t.target.id&&"modal-overlay"!==t.target.id||(o._dom.overlay.classList.remove("visible"),o._dom.colorPicker.container.classList.remove("visible"),o._dom.overlay.removeEventListener("click",n),document.getElementById("color-picker-modal-close").removeEventListener("click",n),e(i.getCurColorHex()))};n=n.bind(this);var i=new window.KellyColorPicker({place:"color-picker",color:t||"#ffffff",changeCursor:!1,userEvents:{change:function(t){document.getElementById("output-color").value=t.getCurColorHex()}}});this._dom.overlay.addEventListener("click",n),document.getElementById("color-picker-modal-close").addEventListener("click",n)}}])&&n(e.prototype,o),t}();function s(t){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]:[255,255,255]}function a(t,e){return new Promise((function(o,n){var i={method:e?"POST":"GET",headers:new Headers([["Content-Type","application/json; charset=UTF-8"],["Accept","application/json"]]),body:JSON.stringify(e)};fetch(t,i).then((function(t){t?t.ok?o(t.json()):n("ERROR_".concat(t.status)):n("ERROR_MISSING_ARGUMENT")})).catch(n)}))}function r(t,e){return new i("COLOR_PICKER",{color:t,callback:function(t){e(t)}})}function c(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var o=[],n=!0,i=!1,s=void 0;try{for(var a,r=t[Symbol.iterator]();!(n=(a=r.next()).done)&&(o.push(a.value),!e||o.length!==e);n=!0);}catch(t){i=!0,s=t}finally{try{n||null==r.return||r.return()}finally{if(i)throw s}}return o}}(t,e)||function(t,e){if(t){if("string"==typeof t)return l(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?l(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,n=new Array(e);o<e;o++)n[o]=t[o];return n}function d(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var u=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._dom={UNIFORM:{button:document.getElementById("manual-uniform"),container:document.getElementById("manual-uniform-options"),color:document.getElementById("manual-uniform-color")},CHASE:{button:document.getElementById("manual-chase"),container:document.getElementById("manual-chase-options"),color:document.getElementById("manual-chase-color")},RAINBOW:{button:document.getElementById("manual-rainbow"),container:document.getElementById("manual-rainbow-options")},CHASE_RAINBOW:{button:document.getElementById("manual-chase-rainbow"),container:document.getElementById("manual-chase-rainbow-options")}},this._initEvents(),this._initState()}var e,o;return e=t,(o=[{key:"_initEvents",value:function(){var t=this;this._dom.UNIFORM.button.addEventListener("click",this._updateEffect.bind(this)),this._dom.CHASE.button.addEventListener("click",this._updateEffect.bind(this)),this._dom.RAINBOW.button.addEventListener("click",this._updateEffect.bind(this)),this._dom.CHASE_RAINBOW.button.addEventListener("click",this._updateEffect.bind(this)),this._dom.UNIFORM.color.addEventListener("click",(function(){event.preventDefault(),r(window.localStorage.getItem("manual-uniform-color"),(function(e){window.localStorage.setItem("manual-uniform-color",e),t._dom.UNIFORM.color.value=e}))})),this._dom.CHASE.color.addEventListener("click",(function(){event.preventDefault(),r(window.localStorage.getItem("manual-chase-color"),(function(e){window.localStorage.setItem("manual-chase-color",e),t._dom.CHASE.color.value=e}))}))}},{key:"_initState",value:function(){this._dom.UNIFORM.color.value=window.localStorage.getItem("manual-uniform-color"),this._dom.CHASE.color.value=window.localStorage.getItem("manual-chase-color")}},{key:"_updateEffect",value:function(t){this._unselectAllEffect(),t.target.classList.add("selected"),window.LF440.effect=t.target.dataset.effect,this._dom[window.LF440.effect].container.style.display="block",!0===window.LF440.isActive?window.LF440.sendAction().then((function(){window.LF440.status="Effect ".concat(window.LF440.effect," activated"),console.log("ManualController : Successfully activate effect ".concat(window.LF440.effect))})).catch((function(){window.LF440.status="Unable to set effect ".concat(window.LF440.effect),console.error("ManualController : Failed to activate effect ".concat(window.LF440.effect))})):(window.LF440.status="Please start LightFever440",console.error("ManualController : Failed to activate effect ".concat(window.LF440.effect,", LightFever440 isn't activated")))}},{key:"_unselectAllEffect",value:function(){for(var t=0,e=Object.entries(this._dom);t<e.length;t++){var o=c(e[t],1)[0];this._dom[o].button.classList.remove("selected"),this._dom[o].container.style.display="none"}}},{key:"initEffect",value:function(t){this._unselectAllEffect(),this._dom[t].button.classList.add("selected"),this._dom[t].container.style.display="block"}},{key:"getActiveEffect",value:function(){for(var t=0,e=Object.entries(this._dom);t<e.length;t++){var o=c(e[t],1)[0];if(this._dom[o].button.classList.contains("selected"))return this._dom[o].container.style.display="block",this._dom[o].button.dataset.effect}return"UNIFORM"}},{key:"getOptions",value:function(){var t={};return"UNIFORM"===window.LF440.effect?t={color:s(window.localStorage.getItem("manual-uniform-color"))}:"CHASE"===window.LF440.effect&&(t={color:s(window.localStorage.getItem("manual-chase-color")),delay:50}),t}}])&&d(e.prototype,o),t}();function m(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var o=[],n=!0,i=!1,s=void 0;try{for(var a,r=t[Symbol.iterator]();!(n=(a=r.next()).done)&&(o.push(a.value),!e||o.length!==e);n=!0);}catch(t){i=!0,s=t}finally{try{n||null==r.return||r.return()}finally{if(i)throw s}}return o}}(t,e)||function(t,e){if(t){if("string"==typeof t)return f(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?f(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,n=new Array(e);o<e;o++)n[o]=t[o];return n}function h(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var v=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._dom={UNIFORM:{button:document.getElementById("auto-uniform"),container:document.getElementById("auto-uniform-options"),peakDetection:document.getElementById("auto-uniform-peak-detection")},PROGRESSIVE:{button:document.getElementById("auto-progressive"),container:document.getElementById("auto-progressive-options"),lightNumber:document.getElementById("auto-progressive-led"),reverse:document.getElementById("auto-progressive-reverse"),lightNumberText:document.getElementById("auto-progressive-led-value")},PULSE:{button:document.getElementById("auto-pulse"),container:document.getElementById("auto-pulse-options"),maxLength:document.getElementById("auto-pulse-length"),color:document.getElementById("auto-pulse-color"),maxLengthText:document.getElementById("auto-pulse-length-value")},PROGRESSIVE_MIRROR:{button:document.getElementById("auto-progressive-mirror"),container:document.getElementById("auto-progressive-mirror-options")}},this._initEvents(),this._initState()}var e,o;return e=t,(o=[{key:"_initEvents",value:function(){var t=this;this._dom.UNIFORM.button.addEventListener("click",this._updateEffect.bind(this)),this._dom.PROGRESSIVE.button.addEventListener("click",this._updateEffect.bind(this)),this._dom.PULSE.button.addEventListener("click",this._updateEffect.bind(this)),this._dom.PROGRESSIVE_MIRROR.button.addEventListener("click",this._updateEffect.bind(this)),this._dom.PROGRESSIVE.lightNumber.addEventListener("input",(function(){t._dom.PROGRESSIVE.lightNumberText.innerHTML=t._dom.PROGRESSIVE.lightNumber.value,window.localStorage.setItem("auto-progressive-led",t._dom.PROGRESSIVE.lightNumber.value)})),this._dom.PULSE.maxLength.addEventListener("input",(function(){t._dom.PULSE.maxLengthText.innerHTML=t._dom.PULSE.maxLength.value,window.localStorage.setItem("auto-pulse-length",t._dom.PULSE.maxLength.value)})),this._dom.PULSE.color.addEventListener("click",(function(e){e.preventDefault(),r("pulse-color",(function(e){t._dom.PULSE.color.value=e}))}))}},{key:"_initState",value:function(){window.rangesliderJs.create(this._dom.PROGRESSIVE.lightNumber,{value:window.localStorage.getItem("auto-progressive-led")||"5"}),window.rangesliderJs.create(this._dom.PULSE.maxLength,{value:window.localStorage.getItem("auto-pulse-length")||"100"})}},{key:"_updateEffect",value:function(t){this._unselectAllEffect(),t.target.classList.add("selected"),window.LF440.effect=t.target.dataset.effect,this._dom[window.LF440.effect].container.style.display="block",!0===window.LF440.isActive?window.LF440.sendAction().then((function(){window.F440.status="Effect ".concat(window.LF440.effect," activated"),console.log("AnalyzerController : Successfully activate effect ".concat(window.LF440.effect))})).catch((function(){window.LF440.status="Unable to set effect ".concat(window.LF440.effect),console.error("AnalyzerController : Failed to activate effect ".concat(window.LF440.effect))})):(window.LF440.status="Please start LightFever440",console.error("AnalyzerController : Failed to activate effect ".concat(window.LF440.effect,", LightFever440 isn't activated")))}},{key:"_unselectAllEffect",value:function(){for(var t=0,e=Object.entries(this._dom);t<e.length;t++){var o=m(e[t],1)[0];this._dom[o].button.classList.remove("selected"),this._dom[o].container.style.display="none"}}},{key:"initEffect",value:function(t){this._unselectAllEffect(),this._dom[t].button.classList.add("selected"),this._dom[t].container.style.display="block"}},{key:"getActiveEffect",value:function(){for(var t=0,e=Object.entries(this._dom);t<e.length;t++){var o=m(e[t],1)[0];if(this._dom[o].button.classList.contains("selected"))return this._dom[o].container.style.display="block",this._dom[o].button.dataset.effect}return"UNIFORM"}},{key:"getOptions",value:function(){var t={};return"UNIFORM"===window.LF440.effect?t={peakDetection:this._dom.UNIFORM.peakDetection.checked}:"PROGRESSIVE"===window.LF440.effect?t={lightNumber:parseInt(this._dom.PROGRESSIVE.lightNumber.value),reverse:this._dom.PROGRESSIVE.reverse.checked}:"PULSE"===window.LF440.effect&&(t={color:s(this._dom.PULSE.color),maxLength:parseInt(this._dom.PULSE.maxLength.value)}),t}}])&&h(e.prototype,o),t}();function g(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var _=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.VERSION="0.0.1",this._dom={title:document.getElementById("title"),version:document.getElementById("version"),toggle:document.getElementById("toggle-light-fever"),manual:document.getElementById("manual-mode"),analyzer:document.getElementById("analyzer-mode"),selection:document.getElementById("selection-border"),manualContainer:document.getElementById("manual-container"),autoContainer:document.getElementById("auto-container"),themeSwitch:document.getElementById("theme-switch"),status:document.getElementById("status-text"),globalButtons:{STROBOSCOPE:document.getElementById("global-stroboscope"),strobOpts:document.getElementById("strob-opts")}},this._isActive=!1,this._isDark=!0,this._previousEffect=null,this._state="OFF",this._mode="MANUAL",this._effect="UNIFORM",this._options=null,this._mc=new u,this._ac=new v,console.log("LightFever440.js - Version ".concat(this.VERSION)),this._initEvents(),this._initState()}var e,o;return e=t,(o=[{key:"_initEvents",value:function(){this._dom.toggle.addEventListener("click",this._toggleLightFever.bind(this)),this._dom.manual.addEventListener("click",this._switchMode.bind(this)),this._dom.analyzer.addEventListener("click",this._switchMode.bind(this)),this._dom.themeSwitch.addEventListener("click",this._switchTheme.bind(this)),this._dom.globalButtons.STROBOSCOPE.addEventListener("touchstart",this._startStroboscope.bind(this)),this._dom.globalButtons.STROBOSCOPE.addEventListener("touchend",this._stopStroboscope.bind(this)),this._dom.globalButtons.strobOpts.addEventListener("click",this._stroboscopeModal.bind(this))}},{key:"_initState",value:function(){var t=this;"light"===window.localStorage.getItem("theme")&&(this._isDark=!1,document.body.classList.remove("dark-theme"),document.body.classList.add("light-theme"),this._dom.themeSwitch.checked=!0,this._dom.status.innerHTML="Switched to light theme"),this._dom.version.innerHTML=this.VERSION,this._getState().then((function(e){t._dom.status.innerHTML="Set Light Fever 440 state","ON"===e.state&&(t._isActive=!0,t._dom.toggle.innerHTML="ON",t._dom.toggle.classList.remove("light-fever-off"),t._dom.toggle.classList.add("light-fever-on")),"AUDIO_ANALYSE"===e.mode&&(t._dom.manual.classList.remove("selected"),t._dom.analyzer.classList.add("selected"),t._dom.selection.style.left="50%",t._dom.manualContainer.style.left="-100%",t._dom.autoContainer.style.left="0",t._mode="AUDIO_ANALYSE"),"UNIFORM"!==e.effect&&("MANUAL"===t._mode?t._mc.initEffect(e.effect):t._ac.initEffect(e.effect)),t._effect=e.effect,console.error("LightFever440 : Light system state preoperly loaded")})).catch((function(e){t._dom.status.innerHTML="Unable to load state",console.error("LightFever440 : Unable to load light system state",e)}))}},{key:"_toggleLightFever",value:function(){!1===this._isActive?(this._isActive=!0,this._dom.toggle.innerHTML="ON",this._dom.toggle.classList.remove("light-fever-off"),this._dom.toggle.classList.add("light-fever-on"),this._startLightFever()):(this._isActive=!1,this._dom.toggle.innerHTML="OFF",this._dom.toggle.classList.remove("light-fever-on"),this._dom.toggle.classList.add("light-fever-off"),this._stopLightFever())}},{key:"_startLightFever",value:function(){var t=this;this._dom.title.classList.add("activated"),this._dom.version.classList.add("activated"),this._state="ON",this.sendAction().then((function(){t._dom.status.innerHTML="Light Fever 440 started",console.log("LightFever440 : Light system successfully started")})).catch((function(e){t._dom.status.innerHTML="Unable to start Light Fever 440",console.error("LightFever440 : Unable to start light system",e)}))}},{key:"_stopLightFever",value:function(){var t=this;this._dom.title.classList.remove("activated"),this._dom.version.classList.remove("activated"),this._state="OFF",this.sendAction().then((function(){t._dom.status.innerHTML="Light Fever 440 stopped",console.log("LightFever440 : Light system successfully stopped")})).catch((function(e){t._dom.status.innerHTML="Unable to stop Light Fever 440",console.error("LightFever440 : Unable to stop light system",e)}))}},{key:"_switchMode",value:function(t){var e=this;"false"===t.target.dataset.manual?(this._dom.manual.classList.remove("selected"),this._dom.analyzer.classList.add("selected"),this._dom.selection.style.left="50%",this._dom.manualContainer.style.left="-100%",this._dom.autoContainer.style.left="0",this._mode="AUDIO_ANALYSE",this._dom.status.innerHTML="Audio analyzer activated",this._effect=this._ac.getActiveEffect()):(this._dom.analyzer.classList.remove("selected"),this._dom.manual.classList.add("selected"),this._dom.selection.style.left="0",this._dom.manualContainer.style.left="0",this._dom.autoContainer.style.left="100%",this._mode="MANUAL",this._dom.status.innerHTML="Manual control activated",this._effect=this._mc.getActiveEffect()),!0===this._isActive&&this.sendAction().then((function(){e._dom.status.innerHTML="Switched to mode ".concat(e._mode),console.log("LightFever440 : Light system mode successfully switched")})).catch((function(t){e._dom.status.innerHTML="Unable to switch mode",console.error("LightFever440 : Unable to switch the light system mode",t)}))}},{key:"_startStroboscope",value:function(t){var e=this;"global-stroboscope"===t.target.id&&(t.preventDefault(),this._previousEffect=this._effect,this._dom.globalButtons.STROBOSCOPE.classList.add("selected"),this._effect="STROBOSCOPE",!0===this._isActive&&this.sendAction().then((function(){e._dom.status.innerHTML="Stroboscope activated",console.log("LightFever440 : Light system stroboscope successfully started")})).catch((function(t){e._dom.status.innerHTML="Unable to start stroboscope",console.error("LightFever440 : Unable to start the stroboscope effect",t)})))}},{key:"_stopStroboscope",value:function(){var t=this;this._effect=this._previousEffect,this._previousEffect=null,this._dom.globalButtons.STROBOSCOPE.classList.remove("selected"),!0===this._isActive&&this.sendAction().then((function(){t._dom.status.innerHTML="Stroboscope deactivated",console.log("LightFever440 : Light system stroboscope successfully stopped")})).catch((function(e){t._dom.status.innerHTML="Unable to stop stroboscope",console.error("LightFever440 : Unable to stop the stroboscope effect",e)}))}},{key:"_setOptionsForEffect",value:function(){"MANUAL"===this._mode?this._options=this._mc.getOptions():this._options=this._ac.getOptions(),"STROBOSCOPE"===this._effect&&(this._options={color:s(window.localStorage.getItem("strob-color")),delay:parseInt(window.localStorage.getItem("strob-delay"))||50}),console.log("LightFever440 : Effect ".concat(this._effect,", Options"),this._options)}},{key:"_switchTheme",value:function(t){!0===t.target.checked?(this._isDark=!1,document.body.classList.remove("dark-theme"),document.body.classList.add("light-theme"),this._dom.status.innerHTML="Switched to light theme",window.localStorage.setItem("theme","light")):(this._isDark=!0,document.body.classList.remove("light-theme"),document.body.classList.add("dark-theme"),this._dom.status.innerHTML="Switched to dark theme",window.localStorage.setItem("theme","dark"))}},{key:"_stroboscopeModal",value:function(){new i("STROBOSCOPE")}},{key:"_getState",value:function(){return new Promise((function(t,e){a("state").then(t).catch(e)}))}},{key:"sendAction",value:function(){var t=this;return new Promise((function(e,o){t._setOptionsForEffect(),a("action",{state:t._state,mode:t._mode,effect:t._effect,options:t._options}).then(e).catch(o).finally((function(){t._options=null}))}))}},{key:"isActive",get:function(){return this._isActive}},{key:"effect",get:function(){return this._effect},set:function(t){this._effect=t}},{key:"status",set:function(t){this._dom.status.innerHTML=t}}])&&g(e.prototype,o),t}();window.LF440=new _;var y=_}},e={};function o(n){if(e[n])return e[n].exports;var i=e[n]={exports:{}};return t[n](i,i.exports,o),i.exports}return o.d=function(t,e){for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o(436)}().default;