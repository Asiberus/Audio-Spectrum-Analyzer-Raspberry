window.LightFever440=function(){"use strict";var t={872:function(t,e){function n(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],s=!0,i=!1,o=void 0;try{for(var a,c=t[Symbol.iterator]();!(s=(a=c.next()).done)&&(n.push(a.value),!e||n.length!==e);s=!0);}catch(t){i=!0,o=t}finally{try{s||null==c.return||c.return()}finally{if(i)throw o}}return n}}(t,e)||function(t,e){if(t){if("string"==typeof t)return s(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,s=new Array(e);n<e;n++)s[n]=t[n];return s}function i(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}var o=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._dom={toggle:document.getElementById("toggle-light-fever"),manual:document.getElementById("manual-mode"),analyzer:document.getElementById("analyzer-mode"),selection:document.getElementById("selection-border"),manualContainer:document.getElementById("manual-container"),autoContainer:document.getElementById("auto-container"),themeSwitch:document.getElementById("theme-switch"),status:document.getElementById("status-text"),manualButtons:{UNIFORM:document.getElementById("manual-uniform"),THEATER_CHASE:document.getElementById("manual-chase"),RAINBOW_CYCLE:document.getElementById("manual-rainbow"),THEATER_CHASE_RAINBOW:document.getElementById("manual-chase-rainbow")},autoButtons:{UNIFORM:document.getElementById("auto-uniform"),PROGRESSIVE:document.getElementById("auto-progressive"),PROGRESSIVE_MIRROR:document.getElementById("auto-progressive-mirror")},globalButtons:{STROBOSCOPE:document.getElementById("global-stroboscope")}},this._isActive=!1,this._isDark=!0,this._previousEffect=null,this._state="OFF",this._mode="MANUAL",this._effect=null,this._options=null,this._initEvents(),this._initState()}var e,s;return e=t,(s=[{key:"_initEvents",value:function(){this._dom.toggle.addEventListener("click",this._toggleLightFever.bind(this)),this._dom.manual.addEventListener("click",this._switchMode.bind(this)),this._dom.analyzer.addEventListener("click",this._switchMode.bind(this)),this._dom.themeSwitch.addEventListener("click",this._switchTheme.bind(this)),this._dom.manualButtons.UNIFORM.addEventListener("click",this._updateEffect.bind(this)),this._dom.manualButtons.THEATER_CHASE.addEventListener("click",this._updateEffect.bind(this)),this._dom.manualButtons.RAINBOW_CYCLE.addEventListener("click",this._updateEffect.bind(this)),this._dom.manualButtons.THEATER_CHASE_RAINBOW.addEventListener("click",this._updateEffect.bind(this)),this._dom.autoButtons.UNIFORM.addEventListener("click",this._updateEffect.bind(this)),this._dom.autoButtons.PROGRESSIVE.addEventListener("click",this._updateEffect.bind(this)),this._dom.autoButtons.PROGRESSIVE_MIRROR.addEventListener("click",this._updateEffect.bind(this)),this._dom.globalButtons.STROBOSCOPE.addEventListener("touchstart",this._startStroboscope.bind(this)),this._dom.globalButtons.STROBOSCOPE.addEventListener("touchend",this._stopStroboscope.bind(this))}},{key:"_initState",value:function(){var t=this;this.getState().then((function(e){if(t._dom.status.innerHTML="Set Light Fever 440 state","ON"===e.state&&(t._isActive=!0,t._dom.toggle.innerHTML="ON",t._dom.toggle.classList.remove("light-fever-off"),t._dom.toggle.classList.add("light-fever-on")),"AUDIO_ANALYSE"===e.mode&&(t._dom.manual.classList.remove("selected"),t._dom.analyzer.classList.add("selected"),t._dom.selection.style.left="50%",t._dom.manualContainer.style.left="-100%",t._dom.autoContainer.style.left="0",t._mode="AUDIO_ANALYSE"),"UNIFORM"!==e.effect){var s={};s="MANUAL"===t._mode?t._dom.manualButtons:t._dom.autoButtons;for(var i=0,o=Object.entries(s);i<o.length;i++){var a=n(o[i],2),c=a[0];a[1],s[c].classList.remove("selected")}s[e.effect].classList.add("selected"),t._effect=e.effect}})).catch((function(e){t._dom.status.innerHTML="Unable to load state"}))}},{key:"_toggleLightFever",value:function(){!1===this._isActive?(this._isActive=!0,this._dom.toggle.innerHTML="ON",this._dom.toggle.classList.remove("light-fever-off"),this._dom.toggle.classList.add("light-fever-on"),this._startLightFever()):(this._isActive=!1,this._dom.toggle.innerHTML="OFF",this._dom.toggle.classList.remove("light-fever-on"),this._dom.toggle.classList.add("light-fever-off"),this._stopLightFever())}},{key:"_startLightFever",value:function(){var t=this;this._state="ON",this.sendAction().then((function(){t._dom.status.innerHTML="Light Fever 440 started"})).catch((function(){t._dom.status.innerHTML="Unable to start Light Fever 440"}))}},{key:"_stopLightFever",value:function(){var t=this;this._state="OFF",this.sendAction().then((function(){t._dom.status.innerHTML="Light Fever 440 stopped"})).catch((function(){t._dom.status.innerHTML="Unable to stop Light Fever 440"}))}},{key:"_switchMode",value:function(t){var e=this;"false"===t.target.dataset.manual?(this._dom.manual.classList.remove("selected"),this._dom.analyzer.classList.add("selected"),this._dom.selection.style.left="50%",this._dom.manualContainer.style.left="-100%",this._dom.autoContainer.style.left="0",this._mode="AUDIO_ANALYSE",this._dom.status.innerHTML="Audio analyzer activated"):(this._dom.analyzer.classList.remove("selected"),this._dom.manual.classList.add("selected"),this._dom.selection.style.left="0",this._dom.manualContainer.style.left="0",this._dom.autoContainer.style.left="100%",this._mode="MANUAL",this._dom.status.innerHTML="Manual control activated"),this.sendAction().then((function(){e._dom.status.innerHTML="Switched to mode ".concat(e._mode)})).catch((function(){e._dom.status.innerHTML="Unable to switch mode"}))}},{key:"_updateEffect",value:function(t){var e=this,s={};s="MANUAL"===this._mode?this._dom.manualButtons:this._dom.autoButtons;for(var i=0,o=Object.entries(s);i<o.length;i++){var a=n(o[i],2),c=a[0];a[1],s[c].classList.remove("selected")}t.target.classList.add("selected"),this._effect=t.target.dataset.effect,this._setOptionsForEffect(),this.sendAction().then((function(){e._dom.status.innerHTML="Effect ".concat(e._effect," activated")})).catch((function(){e._dom.status.innerHTML="Unable to set effect ".concat(e._effect)})).finally((function(){e._options=null}))}},{key:"_setOptionsForEffect",value:function(){"UNIFORM"===this._effect?this._options={COLOR:[255,255,255]}:"THEATER_CHASE"===this._effect&&(this._options={COLOR:[255,255,255],DELAY:50})}},{key:"_startStroboscope",value:function(t){var e=this;t.preventDefault(),this._previousEffect=this._effect,this._dom.globalButtons.STROBOSCOPE.classList.add("selected"),this._effect="STROBOSCOPE",this._options={COLOR:[255,255,255],DELAY:50},this.sendAction().then((function(){e._dom.status.innerHTML="Stroboscope activated"})).catch((function(){e._dom.status.innerHTML="Unable to start stroboscope"})).finally((function(){e._options=null}))}},{key:"_stopStroboscope",value:function(){var t=this;this._effect=this._previousEffect,this._previousEffect=null,this._dom.globalButtons.STROBOSCOPE.classList.remove("selected"),this.sendAction().then((function(){t._dom.status.innerHTML="Stroboscope deactivated"})).catch((function(){t._dom.status.innerHTML="Unable to stop stroboscope"}))}},{key:"_switchTheme",value:function(t){!0===t.target.checked?(this._isDark=!1,document.body.classList.remove("dark-theme"),document.body.classList.add("light-theme"),this._dom.status.innerHTML="Switched to light theme"):(this._isDark=!0,document.body.classList.remove("light-theme"),document.body.classList.add("dark-theme"),this._dom.status.innerHTML="Switched to dark theme")}},{key:"getState",value:function(){var t=this;return new Promise((function(e,n){t.ajax("state").then(e).catch(n)}))}},{key:"sendAction",value:function(){var t=this;return new Promise((function(e,n){t.ajax("action",{state:t._state,mode:t._mode,effect:t._effect,options:t._options}).then(e).catch(n)}))}},{key:"ajax",value:function(t,e){return new Promise((function(n,s){var i={method:e?"POST":"GET",headers:new Headers([["Content-Type","application/json; charset=UTF-8"],["Accept","application/json"]]),body:JSON.stringify(e)};fetch(t,i).then((function(t){t?t.ok?n(t.json()):s("ERROR_".concat(t.status)):s("ERROR_MISSING_ARGUMENT")})).catch(s)}))}}])&&i(e.prototype,s),t}();e.default=o}},e={};return function n(s){if(e[s])return e[s].exports;var i=e[s]={exports:{}};return t[s](i,i.exports,n),i.exports}(872)}().default;